# HID SDK Logs

The SDK produces logs that report device state changes, software actions and decisions, instructions emitted to and received from the app, etc.

Logs are not written to file or visible on the console by default, but can be enabled in various ways depending on where the logs are produced - in Electron's Main process or its Renderer.

## Electron Main

There are two ways to view logs generated by this SDK in Electron's main process (primarily for use in a legacy VDI configuration).

Logs can be viewed in a command line/terminal environment such as Bash or Powershell. In that environment, the `DEBUG` environment variable must be set to 'webrtc-hid'. In Bash the command for this would be `export DEBUG=webrtc-hid`, in Powershell the command would be `$env:DEBUG=”webrtc-hid”`. Once the environment variable is set, then the app must be launched from that **same** terminal (e.g. `npm start` or `yourApp.exe`). This SDK's Main process logs will then be output to the terminal. 

Alternatively, the [`setLogger` API](./README_v1.MD#setloggercustomlogger-optional) can be used to pass in a custom logger such as [electron-log](https://github.com/megahertz/electron-log). If `setLogger` is used, the previous method to view logs in terminal is disabled.

## Electron Renderer / Browser

How and where logs are viewed in the Renderer process is controlled via the `rendererLogs` parameter of the [initializeHIDDevices())](../README.MD#initializehiddevicesconfig) API.

The `rendererLogs` parameter can be either a Boolean (`true`/`false`) or a function. Its default value is `false`, meaning that logs from the renderer process are not visible anywhere. If set to `true`, logs will output at 'info' level to the renderer process console.

```javascript
const initOptions = {...}

initOptions.rendererLogs = true

const HID = initializeHIDDevices(initOptions)
```

If the `rendererLogs` parameter is a function, then logs produced by the HID SDK will be passed to that function for handling. Given that the majority of the logs produced by this SDK are [redux](https://redux.js.org/) actions, the recommended way of handling them is as follows:

```javascript
let storedLogs = []
const maxLogs = 1000

// define a custom logger
const customLogger = (...msg) => {
  // skip processing of empty redux 'action' logs
  if (msg[0].trim() === 'action') msg.shift()

  // at this point, the remaining msg elements can be logged to console:
  console.log(...msg)

  // and/or stored for later retrieval:
  if (storedLogs.length >= maxLogs) {
    storedLogs = storedLogs.slice(msg.length) // delete oldest logs
  }
  storedLogs.push(...msg) // add new logs to end of array
}

initOptions.rendererLogs = customLogger

const HID = initializeHIDDevices(initOptions)
```

## Downloading Stored Logs

If logs are stored per the previous example, use the following methods to download them to file.

### Electron

Log data from the Renderer process must first be sent to the Main process via IPC, and then a Main process IPC handler can write them to file using standard `fs`:

```javascript
  // renderer process

  const filename = `${Date.now().toString()}_hid_logs.txt`

  // format the logs for consumption
  const formattedLogData = storedLogs.map(JSON.stringify).join('\n')

  ipcRenderer.send('saveHIDLogs', filename, formattedLogData)

  // main process
  ipcMain.on('saveHIDLogs', (event, filename, formattedLogData) => {
    const downloads = app.getPath('downloads')
    const filePath = `${downloads}/${filename}`
    fs.writeFileSync(`${filePath}`, formattedLogData)
  })
```

### Browser

The process to write the data to file in a browser is the same as what's used to download WebRTC JS SDK logs:

```javascript
  // renderer process

  const filename = `${Date.now().toString()}_hid_logs.txt`

  // format the logs for consumption
  const formattedLogData = storedLogs.map(JSON.stringify).join('\n')

  const blob = new Blob([formattedLogData])

  // create a button that will save the Blob as a file when clicked
  const button = document.createElement('a')
  button.href = URL.createObjectURL(blob)
  button.download = filename
  button.click() // auto-click the button
```
